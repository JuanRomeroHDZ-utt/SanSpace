################################################################################
ESPECIFICACIÓN DE ENTIDADES DE DATOS (SANSPACE V3.1 - ATÓMICA Y COMPLETA)
Nota: Se incluyen los campos de auditoría explícitamente en cada tabla.
################################################################################

--- NIVEL 0: GEOGRAFÍA Y REGLAS (La base de todo) ---

1. TABLA: countries (Países)
   - country_id (SERIAL)
   - country_name (VARCHAR 100, Unique)
   - country_code (VARCHAR 3)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

2. TABLA: states (Estados/Provincias)
   - state_id (SERIAL)
   - state_name (VARCHAR 100)
   - state_code (VARCHAR 10)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

3. TABLA: cities (Ciudades)
   - city_id (SERIAL)
   - city_name (VARCHAR 100)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

4. TABLA: postal_codes (Códigos Postales)
   - postal_code_id (SERIAL)
   - postal_code_number (VARCHAR 10, Unique)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

5. TABLA: addresses (Direcciones Físicas)
   - address_id (SERIAL)
   - address_street (VARCHAR 255)
   - address_exterior_num (VARCHAR 20)
   - address_interior_num (VARCHAR 20, Nullable)
   - address_colonia (VARCHAR 100)
   - address_references (TEXT)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

6. TABLA: rules (Reglas de uso)
   - rule_id (SERIAL)
   - rule_name (VARCHAR 100)
   - rule_description (TEXT)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

--- NIVEL 1: CATÁLOGOS DEL SISTEMA ---

7. TABLA: roles
   - role_id (SERIAL)
   - role_name (VARCHAR 50, Unique)
   - role_description (VARCHAR 255)
   - role_level (INT)
   - role_permissions (JSON)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

8. TABLA: departments
   - department_id (SERIAL)
   - department_name (VARCHAR 100)
   - department_manager_name (VARCHAR 150)
   - department_notes (TEXT)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

9. TABLA: brands
   - brand_id (SERIAL)
   - brand_name (VARCHAR 100)
   - brand_website (VARCHAR 255)
   - brand_support_phone (VARCHAR 20)
   - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
   - updated_at (TIMESTAMP NULL)
   - is_active (BOOLEAN DEFAULT TRUE)

10. TABLA: active_statuses
    - status_id (SERIAL)
    - status_name (VARCHAR 50)
    - status_color_hex (VARCHAR 7)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

11. TABLA: space_types
    - space_type_id (SERIAL)
    - space_type_name (VARCHAR 50)
    - space_type_description (VARCHAR 255)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

12. TABLA: iot_protocols
    - protocol_id (SERIAL)
    - protocol_name (VARCHAR 50, Unique)
    - protocol_description (VARCHAR 255)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

13. TABLA: measurement_units
    - unit_id (SERIAL)
    - unit_name (VARCHAR 50)
    - unit_symbol (VARCHAR 10)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

14. TABLA: categories
    - category_id (SERIAL)
    - category_name (VARCHAR 100)
    - category_code (VARCHAR 20)
    - category_parent_id (INT, Nullable)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

--- NIVEL 2: ENTIDADES PRINCIPALES (Consumen Nivel 0 y 1) ---

15. TABLA: providers
    - provider_id (SERIAL)
    - provider_name (VARCHAR 150)
    - provider_rfc (VARCHAR 20)
    - provider_contact_name (VARCHAR 150)
    - provider_email (VARCHAR 150)
    - provider_phone (VARCHAR 20)
    - provider_website (VARCHAR 255)
    - address_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

16. TABLA: buildings
    - building_id (SERIAL)
    - building_name (VARCHAR 150)
    - building_emergency_contact (VARCHAR 20)
    - building_latitude (DECIMAL 10,8)
    - building_longitude (DECIMAL 11,8)
    - address_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

17. TABLA: users
    - user_id (SERIAL)
    - user_name (VARCHAR 100)
    - user_last_name (VARCHAR 100)
    - user_email (VARCHAR 150, Unique)
    - user_password_hash (VARCHAR 255)
    - user_cellphone (VARCHAR 20)
    - user_photo_url (VARCHAR 255)
    - user_employee_number (VARCHAR 50)
    - user_emergency_data (JSON)
    - role_id (INT)
    - department_id (INT)
    - address_id (INT, Nullable)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

18. TABLA: iot_sensor_types
    - sensor_type_id (SERIAL)
    - sensor_type_name (VARCHAR 100)
    - sensor_type_datasheet_url (VARCHAR 255)
    - protocol_id (INT)
    - unit_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

19. TABLA: models
    - model_id (SERIAL)
    - model_name (VARCHAR 100)
    - model_release_year (INT)
    - brand_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

--- NIVEL 3: ESTRUCTURA INTERNA Y DISPOSITIVOS ---

20. TABLA: floors
    - floor_id (SERIAL)
    - floor_name (VARCHAR 50)
    - floor_number (INT)
    - building_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

21. TABLA: iot_sensors
    - iot_sensor_id (SERIAL)
    - iot_sensor_name (VARCHAR 100)
    - iot_sensor_serial (VARCHAR 100, Unique)
    - iot_sensor_ip (VARCHAR 45)
    - iot_sensor_mac (VARCHAR 17)
    - iot_sensor_api_endpoint (VARCHAR 255)
    - sensor_type_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

22. TABLA: space_type_rules (Tabla Intermedia)
    - space_rule_id (SERIAL)
    - space_type_id (INT)
    - rule_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

--- NIVEL 4: ESPACIOS E INVENTARIO CORE ---

23. TABLA: spaces
    - space_id (SERIAL)
    - space_name (VARCHAR 100)
    - space_code (VARCHAR 20, Unique)
    - space_capacity (INT)
    - space_square_meters (DECIMAL 10,2)
    - space_has_access_control (BOOLEAN)
    - floor_id (INT)
    - space_type_id (INT)
    - iot_sensor_id (INT, Nullable)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

24. TABLA: actives
    - active_id (SERIAL)
    - active_serial_number (VARCHAR 100, Unique)
    - active_cost (DECIMAL 15,2)
    - active_purchase_date (DATE)
    - active_warranty_expiration (DATE)
    - active_notes (TEXT)
    - active_barcode (VARCHAR 100)
    - active_lifespan_years (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

    - category_id (INT)
    - model_id (INT)
    - provider_id (INT)
    - status_id (INT)
    - space_id (INT)
    - user_id (INT, Nullable)

--- NIVEL 5: TRANSACCIONAL ---

25. TABLA: asset_movements
    - movement_id (SERIAL)
    - movement_date (TIMESTAMP)
    - movement_reason (TEXT)
    - active_id (INT)
    - from_space_id (INT, Nullable)
    - to_space_id (INT)
    - user_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

26. TABLA: asset_files
    - file_id (SERIAL)
    - file_path (VARCHAR 255)
    - file_type (VARCHAR 10)
    - active_id (INT)
    - created_at (TIMESTAMP DEFAULT NOW() NOT NULL)
    - updated_at (TIMESTAMP NULL)
    - is_active (BOOLEAN DEFAULT TRUE)

--- ORACIONES DE RELACIÓN (Para tus FKs) ---

A. GEOGRAFÍA
   - Un Estado pertenece a un País.
   - Una Ciudad pertenece a un Estado.
   - Un Código Postal pertenece a una Ciudad.
   - Una Dirección está asociada a un Código Postal.

B. ENTIDADES CON DIRECCIÓN (Atomicidad)
   - Un Edificio se ubica en una Dirección.
   - Un Proveedor tiene una Dirección fiscal.
   - Un Usuario tiene una Dirección de domicilio (Opcional).

C. USUARIOS Y ORGANIZACIÓN
   - Un Usuario tiene asignado un Rol.
   - Un Usuario trabaja en un Departamento.

D. IoT (SENSORES)
   - Un Tipo de Sensor usa un Protocolo.
   - Un Tipo de Sensor mide en una Unidad.
   - Un Sensor IoT es una instancia de un Tipo de Sensor.

E. MODELOS Y MARCAS
   - Un Modelo es fabricado por una Marca.

F. ESTRUCTURA DEL EDIFICIO
   - Un Piso pertenece a un Edificio.
   - Un Espacio se encuentra dentro de un Piso.
   - Un Espacio se clasifica por un Tipo de Espacio.
   - Un Espacio puede tener asignado un Sensor IoT (Opcional/Unique).

G. REGLAS DE ESPACIO (Muchos a Muchos)
   - Un Tipo de Espacio puede tener muchas Reglas asociadas (Tabla intermedia space_type_rules).

H. INVENTARIO (ACTIVOS)
   - Un Activo pertenece a una Categoría.
   - Un Activo corresponde a un Modelo.
   - Un Activo fue comprado a un Proveedor.
   - Un Activo tiene un Estado actual.
   - Un Activo está ubicado en un Espacio.
   - Un Activo puede estar asignado a un Usuario.

I. HISTORIAL Y ARCHIVOS
   - Un Movimiento pertenece a un Activo.
   - Un Movimiento registra Espacio Origen (nullable) y Destino.
   - Un Movimiento registra al Usuario que hizo el cambio.
   - Un Archivo pertenece a un Activo.

J. RECURSIVIDAD
   - Una Categoría puede tener una Categoría Padre (Nullable).